<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Code Progress</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    flex-direction: column;
  }
  .box {
    background: #1e1e1e;
    padding: 30px;
    border-radius: 10px;
    width: 350px;
    text-align: center;
    margin-bottom: 10px;
    position: relative;
  }
  input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    font-size: 16px;
  }
  button {
    padding: 8px 16px;
    font-size: 16px;
    cursor: pointer;
  }
  .dev-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 12px;
  }
  .back-arrow {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 18px;
    cursor: pointer;
  }
  .hidden { display: none; }
  #redeemedList div {
    margin: 5px 0;
    font-size: 18px;
  }
  #devItemsList div {
    margin: 5px 0;
    font-size: 16px;
    display: flex;
    justify-content: space-between;
  }
</style>
</head>
<body>

<button class="dev-btn" onclick="openDev()">Dev Mode</button>

<!-- Login Screen -->
<div class="box" id="codeScreen">
  <span class="back-arrow" onclick="confirmBack('codeScreen')">&lt;</span>
  <h2>Enter 4-Digit Login Code</h2>
  <p>Remember this code.</p>
  <input id="codeInput" maxlength="4">
  <button onclick="enterLoginCode()">Continue</button>
  <p id="error"></p>
</div>

<!-- Item Screen -->
<div class="box hidden" id="itemScreen">
  <span class="back-arrow" onclick="confirmBack('itemScreen')">&lt;</span>
  <h2>Enter Item Code</h2>
  <input id="itemInput" placeholder="Item Code">
  <button onclick="saveItemCode()">Submit</button>
  <p id="itemMsg"></p>
</div>

<!-- Redeemed Items Screen -->
<div class="box hidden" id="redeemedScreen">
  <span class="back-arrow" onclick="backToItem()">&lt;</span>
  <h2>Redeemed Items</h2>
  <div id="redeemedList"></div>
  <button onclick="backToItem()">Back</button>
</div>

<!-- Dev Login -->
<div class="box hidden" id="devLogin">
  <span class="back-arrow" onclick="hideAll(); codeScreen.classList.remove('hidden');">&lt;</span>
  <h2>Dev Mode</h2>
  <input id="devPass" placeholder="Password">
  <button onclick="checkDev()">Enter</button>
  <p id="devError"></p>
</div>

<!-- Dev Panel -->
<div class="box hidden" id="devPanel">
  <span class="back-arrow" onclick="devPanel.classList.add('hidden'); devLogin.classList.remove('hidden');">&lt;</span>
  <h2>Dev Panel - Manage Items</h2>

  <h3>Add Item</h3>
  <input id="newItemNumber" placeholder="Item Number (e.g. 1)">
  <input id="newItemCode" placeholder="Item Code">
  <button onclick="addItem()">Add Item</button>
  <p id="addItemMsg"></p>

  <h3>Existing Items</h3>
  <div id="devItemsList"></div>

  <button onclick="resetAll()">Reset All Data</button>
</div>

<!-- Redeemed Button -->
<button id="viewRedeemedBtn" class="hidden" onclick="viewRedeemed()" style="margin-top:10px;">View Redeemed Items</button>

<script>
const DEV_PASSWORD = "qwertyuiop...";
let currentLogin = null;

function enterLoginCode() {
  const code = codeInput.value;
  if (!/^\d{4}$/.test(code)) {
    error.textContent = "Enter exactly 4 digits";
    return;
  }
  currentLogin = code;
  localStorage.setItem("loginCode", code);
  codeScreen.classList.add("hidden");
  itemScreen.classList.remove("hidden");
  viewRedeemedBtn.classList.remove("hidden");
}

function saveItemCode() {
  const itemCode = itemInput.value.trim();
  if (!itemCode) return;

  let items = JSON.parse(localStorage.getItem("allItems") || "[]");

  // Check if code exists
  const foundItem = items.find(i => i.code === itemCode);
  if (!foundItem) {
    itemMsg.textContent = "This code does not exist!";
    itemInput.value = "";
    return;
  }

  let redeemed = JSON.parse(localStorage.getItem("redeemed_" + currentLogin) || "[]");

  // Prevent duplicate redemption
  if (redeemed.includes(itemCode)) {
    itemMsg.textContent = "You have already redeemed this code!";
    itemInput.value = "";
    return;
  }

  redeemed.push(itemCode);
  localStorage.setItem("redeemed_" + currentLogin, JSON.stringify(redeemed));
  itemMsg.textContent = "Item code saved!";
  itemInput.value = "";
}

function viewRedeemed() {
  const redeemed = JSON.parse(localStorage.getItem("redeemed_" + currentLogin) || "[]");
  redeemedList.innerHTML = "";
  const items = JSON.parse(localStorage.getItem("allItems") || "[]");
  redeemed.forEach(code => {
    const item = items.find(i => i.code === code);
    if(item){
      const div = document.createElement("div");
      div.textContent = item.number; // Show only item number
      redeemedList.appendChild(div);
    }
  });
  itemScreen.classList.add("hidden");
  redeemedScreen.classList.remove("hidden");
}

function backToItem() {
  redeemedScreen.classList.add("hidden");
  itemScreen.classList.remove("hidden");
}

function openDev() {
  hideAll();
  devLogin.classList.remove("hidden");
}

function checkDev() {
  if (devPass.value !== DEV_PASSWORD) {
    devError.textContent = "Wrong password";
    return;
  }
  devLogin.classList.add("hidden");
  devPanel.classList.remove("hidden");
  loadDevItems();
}

function addItem() {
  const number = newItemNumber.value.trim();
  const code = newItemCode.value.trim();
  if (!number || !code) return;

  let items = JSON.parse(localStorage.getItem("allItems") || "[]");
  if (items.some(i => i.code === code)) {
    addItemMsg.textContent = "This code already exists!";
    return;
  }

  items.push({number, code});
  localStorage.setItem("allItems", JSON.stringify(items));
  addItemMsg.textContent = `Item ${number} added!`;
  newItemNumber.value = "";
  newItemCode.value = "";
  loadDevItems();
}

function deleteItem(code) {
  let items = JSON.parse(localStorage.getItem("allItems") || "[]");
  items = items.filter(i => i.code !== code);
  localStorage.setItem("allItems", JSON.stringify(items));
  loadDevItems();
}

function loadDevItems() {
  const items = JSON.parse(localStorage.getItem("allItems") || "[]");
  const listDiv = document.getElementById("devItemsList");
  listDiv.innerHTML = "";
  items.forEach(item => {
    const div = document.createElement("div");
    div.textContent = `${item.number}: ${item.code}`;
    const delBtn = document.createElement("button");
    delBtn.textContent = "Delete";
    delBtn.style.marginLeft = "10px";
    delBtn.onclick = () => deleteItem(item.code);
    div.appendChild(delBtn);
    listDiv.appendChild(div);
  });
}

function resetAll() {
  localStorage.clear();
  location.reload();
}

function confirmBack(currentPageId) {
  if (currentPageId === 'codeScreen') {
    if (!confirm("Going back will log you out. Continue?")) return;
  }
  hidePage(currentPageId);
  if (currentPageId === 'itemScreen') {
    codeScreen.classList.remove("hidden");
  } else {
    codeScreen.classList.remove("hidden");
  }
}

function hidePage(id) {
  document.getElementById(id).classList.add("hidden");
}

function hideAll() {
  codeScreen.classList.add("hidden");
  itemScreen.classList.add("hidden");
  devLogin.classList.add("hidden");
  devPanel.classList.add("hidden");
  redeemedScreen.classList.add("hidden");
}
</script>

</body>
</html>
